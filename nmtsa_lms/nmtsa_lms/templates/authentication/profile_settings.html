{% extends 'base.html' %}

{% block title %}Profile Settings - NMTSA Learning{% endblock %}

{% block content %}
<section style="max-width: 900px; margin: 0 auto; padding: var(--spacing-2xl) var(--spacing-xl);">
    <div style="margin-bottom: var(--spacing-2xl);">
        <h1 style="font-size: calc(2.5rem * var(--font-scale)); margin-bottom: var(--spacing-lg); color: var(--text-primary);">
            Profile Settings
        </h1>
        <p style="font-size: calc(1.125rem * var(--font-scale)); color: var(--text-secondary);">
            Manage your account information and preferences
        </p>
    </div>

    <form method="post">
        {% csrf_token %}

        <!-- Basic Information -->
        <div class="card" style="padding: var(--spacing-2xl); margin-bottom: var(--spacing-xl);">
            <h2 style="margin-bottom: var(--spacing-xl); font-size: calc(1.5rem * var(--font-scale));">
                Basic Information
            </h2>

            <div style="display: grid; gap: var(--spacing-lg);">
                <!-- First Name -->
                <div>
                    <label for="first_name" style="display: block; margin-bottom: var(--spacing-sm); font-weight: 600; color: var(--text-primary);">
                        First Name
                    </label>
                    <input
                        type="text"
                        id="first_name"
                        name="first_name"
                        value="{{ user.first_name }}"
                        style="width: 100%; padding: var(--spacing-md); border: 1px solid var(--border-color); border-radius: var(--radius-md); font-family: inherit; font-size: calc(1rem * var(--font-scale));"
                    >
                </div>

                <!-- Last Name -->
                <div>
                    <label for="last_name" style="display: block; margin-bottom: var(--spacing-sm); font-weight: 600; color: var(--text-primary);">
                        Last Name
                    </label>
                    <input
                        type="text"
                        id="last_name"
                        name="last_name"
                        value="{{ user.last_name }}"
                        style="width: 100%; padding: var(--spacing-md); border: 1px solid var(--border-color); border-radius: var(--radius-md); font-family: inherit; font-size: calc(1rem * var(--font-scale));"
                    >
                </div>

                <!-- Email (Read-only) -->
                <div>
                    <label for="email" style="display: block; margin-bottom: var(--spacing-sm); font-weight: 600; color: var(--text-primary);">
                        Email Address
                    </label>
                    <input
                        type="email"
                        id="email"
                        value="{{ user.email }}"
                        disabled
                        style="width: 100%; padding: var(--spacing-md); border: 1px solid var(--border-color); border-radius: var(--radius-md); font-family: inherit; font-size: calc(1rem * var(--font-scale)); background: var(--bg-secondary); color: var(--text-secondary);"
                    >
                    <p style="font-size: calc(0.875rem * var(--font-scale)); color: var(--text-secondary); margin-top: var(--spacing-sm);">
                        Email is managed through your OAuth provider and cannot be changed here
                    </p>
                </div>

                <!-- Role (Read-only) -->
                <div>
                    <label style="display: block; margin-bottom: var(--spacing-sm); font-weight: 600; color: var(--text-primary);">
                        Account Type
                    </label>
                    <div style="padding: var(--spacing-md); background: var(--bg-secondary); border-radius: var(--radius-md); color: var(--text-primary); font-weight: 600;">
                        {% if user.is_student %}
                            Student / Family Member
                        {% elif user.is_teacher %}
                            Educator / Therapist
                        {% elif user.is_admin_user %}
                            Administrator
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher-Specific Fields -->
        {% if teacher_profile %}
        <div class="card" style="padding: var(--spacing-2xl); margin-bottom: var(--spacing-xl);">
            <h2 style="margin-bottom: var(--spacing-xl); font-size: calc(1.5rem * var(--font-scale));">
                Professional Information
            </h2>

            {% if teacher_profile.verification_status == 'pending' %}
            <div style="background: var(--warning-light); padding: var(--spacing-lg); border-radius: var(--radius-md); border-left: 4px solid var(--warning); margin-bottom: var(--spacing-xl);">
                <p style="margin: 0; color: var(--text-primary); font-weight: 600;">
                    ⏳ Your teacher account is pending verification
                </p>
            </div>
            {% elif teacher_profile.verification_status == 'approved' %}
            <div style="background: var(--success-light); padding: var(--spacing-lg); border-radius: var(--radius-md); border-left: 4px solid var(--success); margin-bottom: var(--spacing-xl);">
                <p style="margin: 0; color: var(--text-primary); font-weight: 600;">
                    ✓ Your teacher account is verified
                </p>
            </div>
            {% endif %}

            <div style="display: grid; gap: var(--spacing-lg);">
                {% for field in teacher_form %}
                <div>
                    <label for="{{ field.id_for_label }}" style="display: block; margin-bottom: var(--spacing-sm); font-weight: 600; color: var(--text-primary);">
                        {{ field.label }}
                    </label>
                    {{ field }}
                    {% if field.help_text %}
                    <p style="font-size: calc(0.875rem * var(--font-scale)); color: var(--text-secondary); margin-top: var(--spacing-sm);">
                        {{ field.help_text }}
                    </p>
                    {% endif %}
                    {% for error in field.errors %}
                    <p style="color: var(--error); font-size: calc(0.875rem * var(--font-scale)); margin-top: var(--spacing-sm);">{{ error }}</p>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Student-Specific Fields -->
        {% if student_profile %}
        <div class="card" style="padding: var(--spacing-2xl); margin-bottom: var(--spacing-xl);">
            <h2 style="margin-bottom: var(--spacing-xl); font-size: calc(1.5rem * var(--font-scale));">
                Learning Preferences
            </h2>

            <div style="display: grid; gap: var(--spacing-lg);">
                <!-- Relationship -->
                <div>
                    <label for="relationship" style="display: block; margin-bottom: var(--spacing-sm); font-weight: 600; color: var(--text-primary);">
                        Relationship to Care Recipient
                    </label>
                    <select
                        id="relationship"
                        name="relationship"
                        style="width: 100%; padding: var(--spacing-md); border: 1px solid var(--border-color); border-radius: var(--radius-md); font-family: inherit; font-size: calc(1rem * var(--font-scale)); background: var(--bg-card);"
                    >
                        {% for value, label in relationship_choices %}
                        <option value="{{ value }}" {% if student_profile.relationship == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                {% for field in student_form %}
                <div>
                    <label for="{{ field.id_for_label }}" style="display: block; margin-bottom: var(--spacing-sm); font-weight: 600; color: var(--text-primary);">
                        {{ field.label }}
                    </label>
                    {{ field }}
                    {% if field.help_text %}
                    <p style="font-size: calc(0.875rem * var(--font-scale)); color: var(--text-secondary); margin-top: var(--spacing-sm);">
                        {{ field.help_text }}
                    </p>
                    {% endif %}
                    {% for error in field.errors %}
                    <p style="color: var(--error); font-size: calc(0.875rem * var(--font-scale)); margin-top: var(--spacing-sm);">{{ error }}</p>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Save Button -->
        <div style="text-align: center;">
            <button type="submit" class="btn btn-primary btn-lg" style="min-width: 200px;">
                Save Changes
            </button>
        </div>
    </form>
</section>
{% endblock %}
