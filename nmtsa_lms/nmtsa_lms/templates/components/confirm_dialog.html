{# Reusable Confirmation Dialog Component
   Usage:
   {% include 'components/confirm_dialog.html' with
      dialog_id='delete-course'
      title='Delete Course?'
      message='Are you sure you want to delete this course? This action cannot be undone.'
      confirm_text='Yes, Delete Course'
      cancel_text='Cancel'
      confirm_action='deleteCourse()'
      is_destructive=True
   %}

   Parameters:
   - dialog_id: Unique ID for this dialog (required)
   - title: Dialog title (required)
   - message: Explanation text (required)
   - confirm_text: Text for confirm button (default: "Confirm")
   - cancel_text: Text for cancel button (default: "Cancel")
   - confirm_action: JavaScript function to call on confirm (required)
   - is_destructive: true|false - Use warning color for confirm button (default: false)
   - is_reversible: true|false - Show "This can be undone" message (default: false)
#}

<!-- Dialog Overlay -->
<div id="{{ dialog_id }}-overlay"
     class="dialog-overlay"
     style="
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: rgba(0, 0, 0, 0.5);
         z-index: 1000;
         align-items: center;
         justify-content: center;
         padding: var(--spacing-lg);
     "
     role="dialog"
     aria-modal="true"
     aria-labelledby="{{ dialog_id }}-title"
     aria-describedby="{{ dialog_id }}-message"
     onclick="if(event.target === this) closeDialog('{{ dialog_id }}')">

    <!-- Dialog Box -->
    <div style="
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        border: 2px solid var(--border-color);
        max-width: 500px;
        width: 100%;
        box-shadow: var(--shadow-lg);
        padding: var(--spacing-2xl);
    " onclick="event.stopPropagation()">

        <!-- Dialog Header -->
        <div style="margin-bottom: var(--spacing-lg);">
            <h2 id="{{ dialog_id }}-title"
                style="
                    margin: 0 0 var(--spacing-sm) 0;
                    font-size: calc(1.5rem * var(--font-scale));
                    color: {% if is_destructive %}#C62828{% else %}var(--text-primary){% endif %};
                ">
                {{ title }}
            </h2>
        </div>

        <!-- Dialog Message -->
        <div id="{{ dialog_id }}-message"
             style="
                 margin-bottom: var(--spacing-xl);
                 color: var(--text-primary);
                 font-size: calc(1rem * var(--font-scale));
                 line-height: 1.6;
             ">
            {{ message|safe }}
        </div>

        <!-- Reversibility Notice -->
        {% if is_reversible %}
        <div style="
            background: #E3F2FD;
            border: 1px solid #42A5F5;
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: #1565C0;
            font-size: calc(0.875rem * var(--font-scale));
        ">
            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <span>This action can be undone later.</span>
        </div>
        {% else %}
        <div style="
            background: #FFF3E0;
            border: 1px solid #FFA726;
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: #E65100;
            font-size: calc(0.875rem * var(--font-scale));
        ">
            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                <path d="m10.29 3.86 8.64 16.28c.35.67-.07 1.49-.82 1.49H5.89c-.75 0-1.17-.82-.82-1.49L13.7 3.86a.967.967 0 0 1 1.68 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            <span><strong>This action cannot be undone.</strong></span>
        </div>
        {% endif %}

        <!-- Dialog Actions -->
        <div style="
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            flex-wrap: wrap;
        ">
            <!-- Cancel Button (Safe, Right Side) -->
            <button type="button"
                    onclick="closeDialog('{{ dialog_id }}')"
                    style="
                        padding: var(--spacing-md) var(--spacing-xl);
                        background: var(--bg-secondary);
                        color: var(--text-primary);
                        border: 1px solid var(--border-color);
                        border-radius: var(--radius-md);
                        font-size: calc(1rem * var(--font-scale));
                        font-weight: 600;
                        cursor: pointer;
                        min-width: 120px;
                    "
                    autofocus>
                {{ cancel_text|default:"Cancel" }}
            </button>

            <!-- Confirm Button (Destructive, Left Side) -->
            <button type="button"
                    onclick="{{ confirm_action }}; closeDialog('{{ dialog_id }}')"
                    style="
                        padding: var(--spacing-md) var(--spacing-xl);
                        background: {% if is_destructive %}#EF5350{% else %}var(--primary){% endif %};
                        color: white;
                        border: none;
                        border-radius: var(--radius-md);
                        font-size: calc(1rem * var(--font-scale));
                        font-weight: 600;
                        cursor: pointer;
                        min-width: 120px;
                    ">
                {{ confirm_text|default:"Confirm" }}
            </button>
        </div>

        <!-- Keyboard Hint -->
        <div style="
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: calc(0.75rem * var(--font-scale));
            text-align: center;
        ">
            Press <kbd style="background: var(--bg-secondary); padding: 2px 6px; border-radius: 3px; font-family: monospace;">ESC</kbd> to cancel
        </div>
    </div>
</div>

<script>
// Open dialog function
function openDialog(dialogId) {
    const overlay = document.getElementById(dialogId + '-overlay');
    if (overlay) {
        overlay.style.display = 'flex';
        // Focus trap: focus first button
        const firstButton = overlay.querySelector('button');
        if (firstButton) {
            setTimeout(() => firstButton.focus(), 100);
        }
    }
}

// Close dialog function
function closeDialog(dialogId) {
    const overlay = document.getElementById(dialogId + '-overlay');
    if (overlay) {
        overlay.style.display = 'none';
    }
}

// ESC key to close
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const openDialogs = document.querySelectorAll('.dialog-overlay[style*="display: flex"]');
        openDialogs.forEach(dialog => {
            dialog.style.display = 'none';
        });
    }
});
</script>

<style>
/* Focus styles for accessibility */
.dialog-overlay button:focus {
    outline: 3px solid var(--primary);
    outline-offset: 2px;
}

/* Button hover states */
.dialog-overlay button:hover {
    filter: brightness(0.95);
}
</style>
