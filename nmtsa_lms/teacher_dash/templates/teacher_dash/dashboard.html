{% extends 'base.html' %}

{% block title %}Teacher Dashboard - NMTSA Learning{% endblock %}

{% block extra_css %}
{% include 'components/drawer_styles.html' %}
{% endblock %}

{% block content %}
{% include 'components/drawer_toggle.html' %}

<div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <aside class="dashboard-sidebar" id="dashboardSidebar">
        {% include 'components/sidebar_teacher.html' %}
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
        <div class="page-header">
            <h1 class="page-title">Teacher Dashboard</h1>
            <p class="page-description">Manage your courses and track student engagement</p>
        </div>

        <!-- Approval Status Banner -->
        {% if not is_teacher_approved %}
        <div class="alert alert-warning" style="margin-bottom: var(--spacing-xl); padding: var(--spacing-lg); background: #FFF3CD; border: 1px solid #FFEAA7; border-radius: 8px; color: #856404;">
            <h3 style="margin: 0 0 var(--spacing-sm) 0; display: flex; align-items: center; gap: var(--spacing-sm);">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                </svg>
                Verification Required
            </h3>
            <p style="margin: 0;">
                Your teacher profile isn't approved yet. Please wait for verification to create or edit courses. 
                <a href="{% url 'teacher_verification_status' %}" style="color: #856404; text-decoration: underline;">View verification status</a>
            </p>
        </div>
        {% endif %}

        <!-- Quick Stats -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-2xl);">
            <div class="card" style="text-align: center;">
                <h3 style="font-size: calc(2.5rem * var(--font-scale)); margin: 0; color: #7FA8C9;">
                    {{ course_count|default:0 }}
                </h3>
                <p style="color: var(--text-secondary); margin-top: var(--spacing-sm);">
                    Total Courses
                </p>
            </div>

            <div class="card" style="text-align: center;">
                <h3 style="font-size: calc(2.5rem * var(--font-scale)); margin: 0; color: #A8C9A8;">
                    {{ published_count|default:0 }}
                </h3>
                <p style="color: var(--text-secondary); margin-top: var(--spacing-sm);">
                    Published Courses
                </p>
            </div>

            <div class="card" style="text-align: center;">
                <h3 style="font-size: calc(2.5rem * var(--font-scale)); margin: 0; color: #D9C9B3;">
                    {{ draft_count|default:0 }}
                </h3>
                <p style="color: var(--text-secondary); margin-top: var(--spacing-sm);">
                    Draft Courses
                </p>
            </div>

            <div class="card" style="text-align: center;">
                <h3 style="font-size: calc(2.5rem * var(--font-scale)); margin: 0; color: #B8D4E6;">
                    {{ verification_status|default:'pending'|title }}
                </h3>
                <p style="color: var(--text-secondary); margin-top: var(--spacing-sm);">
                    Verification Status
                </p>
            </div>
        </div>

        <!-- Quick Actions -->
        <section style="margin-bottom: var(--spacing-2xl);">
            <h2 style="margin-bottom: var(--spacing-lg);">Quick Actions</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md);">
                {% if is_teacher_approved %}
                <a href="/teacher/courses/create/" class="btn btn-primary btn-lg" style="text-decoration: none;">
                    Create New Course
                </a>
                {% endif %}
                <a href="/teacher/courses/" class="btn btn-outline btn-lg" style="text-decoration: none;">
                    Manage Courses
                </a>
            </div>
        </section>

        <!-- Your Courses -->
        <section>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                <h2 style="margin: 0;">Draft Courses</h2>
            </div>

            {% if draft_courses %}
            <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                {% for course in draft_courses %}
                <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex-grow: 1;">
                        <h3 style="margin: 0 0 var(--spacing-sm) 0;">{{ course.title }}</h3>
                        <p style="color: var(--text-secondary); margin: 0; font-size: calc(0.875rem * var(--font-scale));">
                            Created {{ course.published_date|date:"M d, Y" }}<br>
                            {% if course.is_submitted_for_review %}Pending admin review{% else %}Draft{% endif %}
                        </p>
                    </div>
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <a href="{% url 'teacher_course_detail' course.slug %}" class="btn btn-outline btn-sm" style="text-decoration: none;">
                            View
                        </a>
                        <a href="{% url 'teacher_course_edit' course.slug %}" class="btn btn-outline btn-sm" style="text-decoration: none;">
                            Edit
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-info">
                <p style="margin: 0;">
                    You don't have any draft courses yet.
                    <a href="/teacher/courses/create/" style="font-weight: 600;">Create a course</a> to get started!
                </p>
            </div>
            {% endif %}
        </section>

        <section style="margin-top: var(--spacing-2xl);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                <h2 style="margin: 0;">Published Courses</h2>
            </div>

            {% if published_courses %}
            <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                {% for course in published_courses %}
                <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex-grow: 1;">
                        <h3 style="margin: 0 0 var(--spacing-sm) 0;">{{ course.title }}</h3>
                        <p style="color: var(--text-secondary); margin: 0; font-size: calc(0.875rem * var(--font-scale));">
                            {{ course.enrollments.count }} students enrolled
                        </p>
                    </div>
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <a href="{% url 'teacher_course_detail' course.slug %}" class="btn btn-outline btn-sm" style="text-decoration: none;">
                            Manage
                        </a>
                        <a href="{% url 'teacher_course_analytics' course.slug %}" class="btn btn-outline btn-sm" style="text-decoration: none;">
                            Analytics
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-muted">
                <p style="margin: 0;">No courses published yet. Publish a course to make it visible to students.</p>
            </div>
            {% endif %}
        </section>
    </main>
</div>

{% include 'components/drawer_script.html' %}
{% endblock %}
