{% extends "base.html" %}
{% load static %}

{% block title %}{% if action == 'create' %}New Discussion{% else %}Edit Post{% endif %} - {{ course.title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6 max-w-3xl">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-4 text-gray-600">
        <a href="{% url 'teacher_dashboard' %}" class="hover:text-blue-600">Dashboard</a>
        <span class="mx-2">/</span>
        <a href="{% url 'teacher_course_detail' course.id %}" class="hover:text-blue-600">{{ course.title }}</a>
        <span class="mx-2">/</span>
        <a href="{% url 'teacher_course_discussions' course.id %}" class="hover:text-blue-600">Discussions</a>
        <span class="mx-2">/</span>
        <span class="text-gray-900 font-medium">
            {% if action == 'create' %}New Discussion{% else %}Edit Post{% endif %}
        </span>
    </nav>

    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
            {% if action == 'create' %}
                Start a New Discussion
            {% else %}
                Edit Post
            {% endif %}
        </h1>
        <p class="text-gray-600">{{ course.title }}</p>
    </div>

    <!-- Form -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
        <form method="post" id="discussionForm">
            {% csrf_token %}

            <div class="mb-6">
                <label for="id_content" class="block text-sm font-medium text-gray-700 mb-2">
                    {{ form.content.label }}
                </label>
                {{ form.content }}
                {% if form.content.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ form.content.errors.0 }}</p>
                {% endif %}

                <!-- Character Counter -->
                <div class="mt-2 flex justify-between items-center text-sm">
                    <span class="text-gray-500">
                        Minimum 10 characters, maximum 2000 characters
                    </span>
                    <span id="charCount" class="font-medium text-gray-700">
                        0 / 2000
                    </span>
                </div>
            </div>

            {% if action == 'edit' %}
                <div class="mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <p class="text-sm text-yellow-800">
                        <strong>Note:</strong> As a teacher, you can edit any post in your course. After editing, the post will be marked as "edited".
                    </p>
                </div>
            {% endif %}

            <div class="flex gap-3">
                <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-medium">
                    {% if action == 'create' %}
                        Post Discussion
                    {% else %}
                        Save Changes
                    {% endif %}
                </button>
                <a href="{% if post %}{% url 'teacher_discussion_detail' course.id post.id %}{% else %}{% url 'teacher_course_discussions' course.id %}{% endif %}" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition font-medium">
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Guidelines -->
    <div class="mt-6 bg-green-50 border border-green-200 rounded-lg p-4">
        <h3 class="font-semibold text-green-900 mb-2">Teacher Best Practices</h3>
        <ul class="text-sm text-green-800 space-y-1">
            <li>• Encourage student participation and engagement</li>
            <li>• Provide clear guidance and helpful responses</li>
            <li>• Pin important announcements or discussions</li>
            <li>• Moderate respectfully and constructively</li>
        </ul>
    </div>
</div>

<script>
    // Character counter
    const textarea = document.getElementById('id_content');
    const charCount = document.getElementById('charCount');

    function updateCharCount() {
        const length = textarea.value.length;
        charCount.textContent = `${length} / 2000`;

        // Change color based on length
        if (length < 10) {
            charCount.classList.add('text-red-600');
            charCount.classList.remove('text-green-600', 'text-gray-700');
        } else if (length > 1900) {
            charCount.classList.add('text-orange-600');
            charCount.classList.remove('text-green-600', 'text-gray-700');
        } else {
            charCount.classList.add('text-green-600');
            charCount.classList.remove('text-red-600', 'text-orange-600', 'text-gray-700');
        }
    }

    if (textarea) {
        textarea.addEventListener('input', updateCharCount);
        // Initialize on page load
        updateCharCount();
    }

    // Auto-expand textarea
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
    });
</script>

<style>
    #id_content {
        width: 100%;
        min-height: 200px;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-family: inherit;
        font-size: 1rem;
        line-height: 1.5;
        resize: vertical;
    }

    #id_content:focus {
        outline: none;
        border-color: #3b82f6;
        ring: 2px;
        ring-color: #3b82f680;
    }
</style>
{% endblock %}
