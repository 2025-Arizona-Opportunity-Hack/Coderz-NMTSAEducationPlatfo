{% extends "base.html" %}
{% load static %}
{% block title %}
{% if is_edit %}Edit Discussion{% else %}Start a Discussion{% endif %} - {{ course.title }}
{% endblock %}
{% block content %}
<div>
    <!-- Breadcrumbs -->
    <nav style="display:flex; align-items:center; gap:8px; color: var(--text-secondary); font-size: calc(0.875rem * var(--font-scale)); margin-bottom: var(--spacing-lg);">
        <a href="{% url 'student_dashboard' %}" style="color: inherit; text-decoration: none;">Dashboard</a>
        <span style="color: var(--text-muted);">›</span>
        <a href="{% url 'student_course_detail' course.slug %}" style="color: inherit; text-decoration: none;">{{ course.title|truncatewords:3 }}</a>
        <span style="color: var(--text-muted);">›</span>
        <a href="{% url 'student_course_discussions' course.slug %}" style="color: inherit; text-decoration: none;">Discussions</a>
        <span style="color: var(--text-muted);">›</span>
        <span style="color: var(--text-primary); font-weight: 600;">{% if is_edit %}Edit{% else %}New{% endif %} Post</span>
    </nav>

    <div style="margin-bottom: var(--spacing-xl);">
        <a href="{% url 'student_course_discussions' course.slug %}" class="btn btn-outline" style="display:inline-flex; align-items:center; gap:8px; text-decoration:none;">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            Back to Discussions
        </a>
    </div>

    <div class="card">
        <h2 style="margin-top:0;">{% if is_edit %}Edit Discussion{% else %}Start a New Discussion{% endif %}</h2>
        {% if form.non_field_errors %}
            <div class="alert alert-info" style="margin-top: var(--spacing-sm); color:#B71C1C;">{{ form.non_field_errors.0 }}</div>
        {% endif %}

        <form method="post" id="discussionForm">
            {% csrf_token %}

            <div style="margin-bottom: var(--spacing-md);">
                <label for="id_title" style="display:block; margin-bottom: var(--spacing-xs); font-weight:600;">Title</label>
                {{ form.title }}
                {% if form.title.errors %}
                <div class="alert alert-info" style="margin-top: var(--spacing-xs); color:#B71C1C;">{{ form.title.errors.0 }}</div>
                {% endif %}
            </div>

            <div style="margin-bottom: var(--spacing-md);">
                <label for="id_content" style="display:block; margin-bottom: var(--spacing-xs); font-weight:600;">Content</label>
                {{ form.content }}
                {% if form.content.errors %}
                <div class="alert alert-info" style="margin-top: var(--spacing-xs); color:#B71C1C;">{{ form.content.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="alert" style="background:#E3F2FD; color:#0D47A1; border:1px solid #BBDEFB;">
                <p style="margin:0; font-weight:600;">Tips for a great discussion post:</p>
                <ul style="margin: var(--spacing-xs) 0 0 1.2rem;">
                    <li>Be clear and concise</li>
                    <li>Provide context to your question</li>
                    <li>Include what you've tried so far</li>
                    <li>Be respectful and follow community guidelines</li>
                </ul>
            </div>

            <div style="display:flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);">
                <button type="submit" class="btn btn-primary">{% if is_edit %}Update Post{% else %}Create Post{% endif %}</button>
                <a href="{% url 'student_course_discussions' course.slug %}" class="btn btn-outline">Cancel</a>
            </div>
        </form>
    </div>
</div>

<style>
/* Minimal fallback styles if form widgets are plain */
#id_title, #id_content {
  width: 100%;
  padding: 0.75rem 0.875rem;
  border: 1px solid var(--border-color, #e5e7eb);
  border-radius: 8px;
  font: inherit;
}
#id_content { min-height: 180px; resize: vertical; }
#id_title:focus, #id_content:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.15); }
</style>
{% endblock %}
        </ul>
