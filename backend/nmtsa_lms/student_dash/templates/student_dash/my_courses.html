{% extends 'base.html' %}

{% block title %}My Courses - NMTSA Learning{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">My Courses</h1>
    <p class="page-description">Track your progress and continue learning</p>
</div>

<!-- Course Status Tabs (Simple, No Animations) -->
<div style="margin-bottom: var(--spacing-xl); border-bottom: 2px solid var(--border-color);">
    <div style="display: flex; gap: var(--spacing-md);">
        <button onclick="filterCourses('all')"
                id="tab-all"
                class="tab-btn"
                style="padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: calc(1rem * var(--font-scale)); font-weight: 500; color: var(--text-primary);">
            All Courses
        </button>
        <button onclick="filterCourses('in-progress')"
                id="tab-in-progress"
                class="tab-btn"
                style="padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: calc(1rem * var(--font-scale)); font-weight: 500; color: var(--text-primary);">
            In Progress
        </button>
        <button onclick="filterCourses('completed')"
                id="tab-completed"
                class="tab-btn"
                style="padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: calc(1rem * var(--font-scale)); font-weight: 500; color: var(--text-primary);">
            Completed
        </button>
    </div>
</div>

<!-- Course List -->
{% if enrolled_courses %}
<div id="courses-container" style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
    {% for course in enrolled_courses %}
    <div class="card course-item" data-status="{% if course.progress == 100 %}completed{% elif course.progress > 0 %}in-progress{% else %}not-started{% endif %}" style="display: flex; gap: var(--spacing-lg); align-items: start;">
        <!-- Course Thumbnail -->
        <div style="flex-shrink: 0; width: 200px; height: 120px; border-radius: 6px; overflow: hidden;">
            {% if course.image %}
            <img src="{{ course.image }}" alt="{{ course.title }}" style="width: 100%; height: 100%; object-fit: cover;">
            {% else %}
            <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #E8F1F8 0%, #D9E8F4 100%); display: flex; align-items: center; justify-content: center;">
                <svg width="48" height="48" fill="none" stroke="#7FA8C9" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
            </div>
            {% endif %}
        </div>

        <!-- Course Info -->
        <div style="flex-grow: 1;">
            <h2 style="margin-top: 0; margin-bottom: var(--spacing-sm);">
                <a href="/courses/{{ course.id }}/learn/" style="text-decoration: none; color: var(--text-primary);">
                    {{ course.title }}
                </a>
            </h2>

            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                {{ course.description|truncatewords:25 }}
            </p>

            <!-- Progress -->
            <div style="margin-bottom: var(--spacing-md);">
                {% include 'components/progress_bar.html' with percentage=course.progress %}
            </div>

            <!-- Meta Info -->
            <div style="display: flex; gap: var(--spacing-lg); color: var(--text-muted); font-size: calc(0.875rem * var(--font-scale));">
                <span>{{ course.completed_lessons|default:0 }} of {{ course.total_lessons|default:10 }} lessons completed</span>
                <span>Last accessed: {{ course.last_accessed|default:"Never" }}</span>
            </div>
        </div>

        <!-- Actions -->
        <div style="flex-shrink: 0; display: flex; flex-direction: column; gap: var(--spacing-sm);">
            {% if course.progress == 100 %}
            <a href="/courses/{{ course.id }}/certificate/" class="btn btn-success btn-sm" style="text-decoration: none; white-space: nowrap;">
                View Certificate
            </a>
            <a href="/courses/{{ course.id }}/learn/" class="btn btn-outline btn-sm" style="text-decoration: none; white-space: nowrap;">
                Review Course
            </a>
            {% else %}
            <a href="/courses/{{ course.id }}/learn/" class="btn btn-primary btn-sm" style="text-decoration: none; white-space: nowrap;">
                {% if course.progress > 0 %}Resume{% else %}Start{% endif %} Course
            </a>
            <a href="/courses/{{ course.id }}/" class="btn btn-outline btn-sm" style="text-decoration: none; white-space: nowrap;">
                Course Details
            </a>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info" style="text-align: center; padding: var(--spacing-2xl);">
    <svg width="64" height="64" fill="none" stroke="#7FA8C9" stroke-width="2" viewBox="0 0 24 24" style="margin: 0 auto var(--spacing-lg);">
        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
    </svg>
    <h3>No enrolled courses yet</h3>
    <p style="margin-bottom: var(--spacing-lg);">Browse our course catalog to start learning</p>
    <a href="/browse-courses/" class="btn btn-primary">Browse Courses</a>
</div>
{% endif %}

<script>
// Simple tab filtering (no animations)
let activeFilter = 'all';

function filterCourses(status) {
    activeFilter = status;

    // Update tab styles
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.borderBottomColor = 'transparent';
        btn.style.color = 'var(--text-primary)';
    });

    const activeTab = document.getElementById('tab-' + status);
    if (activeTab) {
        activeTab.style.borderBottomColor = '#7FA8C9';
        activeTab.style.color = '#7FA8C9';
    }

    // Filter courses
    document.querySelectorAll('.course-item').forEach(item => {
        const courseStatus = item.getAttribute('data-status');

        if (status === 'all') {
            item.style.display = 'flex';
        } else if (status === 'in-progress' && (courseStatus === 'in-progress' || courseStatus === 'not-started')) {
            item.style.display = 'flex';
        } else if (status === 'completed' && courseStatus === 'completed') {
            item.style.display = 'flex';
        } else {
            item.style.display = 'none';
        }
    });
}

// Initialize with all courses
filterCourses('all');
</script>
{% endblock %}
