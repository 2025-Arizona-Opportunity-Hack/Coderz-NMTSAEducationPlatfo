{% load static %}

<nav class="navbar" style="display: flex; justify-content: space-between; align-items: center;">
    <div style="display: flex; align-items: center; gap: var(--spacing-lg);">
        <!-- Brand/Logo -->
        <a href="/" class="navbar-brand" style="text-decoration: none;">
            NMTSA Learning
        </a>

        <!-- Main Navigation Links -->
        <div class="navbar-menu" style="display: flex; gap: var(--spacing-md);">
            {% if request.session.user %}
                <!-- Authenticated User Menu -->
                {% if request.session.user.role == 'admin' %}
                    <a href="{% url 'admin_dashboard' %}" class="nav-link {% if '/admin-dash/' in request.path %}active{% endif %}">
                        Admin Dashboard
                    </a>
                {% endif %}

                {% if request.session.user.role == 'teacher' %}
                    <a href="{% url 'teacher_dashboard' %}" class="nav-link {% if '/teacher/' in request.path %}active{% endif %}">
                        Teacher Dashboard
                    </a>
                {% endif %}

                {% if request.session.user.role == 'student' %}
                    <a href="{% url 'student_courses' %}" class="nav-link {% if '/student/courses/' in request.path %}active{% endif %}">
                        My Courses
                    </a>

                    <a href="{% url 'student_catalog' %}" class="nav-link {% if '/student/catalog/' in request.path %}active{% endif %}">
                        Browse Courses
                    </a>
                {% endif %}
            {% else %}
                <!-- Guest User Menu -->
                <a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}">
                    Home
                </a>

                <a href="/#about" class="nav-link {% if request.path == '/#about' %}active{% endif %}">
                    About
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Right Side Menu -->
    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
        <!-- Accessibility Controls (Theme + Font Size) -->
        <div class="accessibility-controls" style="display: flex; align-items: center; gap: 6px; padding: 6px; background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
            <!-- Theme Switcher Buttons -->
            <div style="display: flex; gap: 4px;">
                <button onclick="setTheme('light')"
                        id="theme-light"
                        class="theme-btn"
                        style="width: 32px; height: 32px; padding: 4px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-card); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);"
                        aria-label="Light theme"
                        title="Light theme - Modern, clean colors">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                </button>

                <button onclick="setTheme('dark')"
                        id="theme-dark"
                        class="theme-btn"
                        style="width: 32px; height: 32px; padding: 4px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-card); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);"
                        aria-label="Dark theme"
                        title="Dark theme - Reduced light, easier on eyes">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>

                <button onclick="setTheme('contrast')"
                        id="theme-contrast"
                        class="theme-btn"
                        style="width: 32px; height: 32px; padding: 4px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-card); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);"
                        aria-label="High contrast theme"
                        title="High contrast - Black and white for better visibility">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 2v20"/>
                    </svg>
                </button>

                <button onclick="setTheme('minimal')"
                        id="theme-minimal"
                        class="theme-btn"
                        style="width: 32px; height: 32px; padding: 4px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-card); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);"
                        aria-label="Minimal theme"
                        title="Minimal - No styling, best for screen readers">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M4 7h16M4 12h16M4 17h16"/>
                    </svg>
                </button>
            </div>

            <!-- Divider -->
            <div style="width: 1px; height: 28px; background: var(--border-color); margin: 0 2px;"></div>

            <!-- Font Size Controls -->
            <div style="display: flex; gap: 4px;">
                <button onclick="setFontSize('small')"
                        id="font-small"
                        class="font-btn"
                        style="width: 32px; height: 32px; padding: 4px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-card); cursor: pointer; font-size: 10px; font-weight: 700; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);"
                        aria-label="Small font size"
                        title="Small text size">
                    A-
                </button>

                <button onclick="setFontSize('medium')"
                        id="font-medium"
                        class="font-btn"
                        style="width: 32px; height: 32px; padding: 4px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-card); cursor: pointer; font-size: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);"
                        aria-label="Medium font size"
                        title="Medium text size (default)">
                    A
                </button>

                <button onclick="setFontSize('large')"
                        id="font-large"
                        class="font-btn"
                        style="width: 32px; height: 32px; padding: 4px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-card); cursor: pointer; font-size: 14px; font-weight: 700; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);"
                        aria-label="Large font size"
                        title="Large text size">
                    A+
                </button>

                <button onclick="setFontSize('xlarge')"
                        id="font-xlarge"
                        class="font-btn"
                        style="width: 32px; height: 32px; padding: 4px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-card); cursor: pointer; font-size: 16px; font-weight: 700; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);"
                        aria-label="Extra large font size"
                        title="Extra large text size">
                    A++
                </button>
            </div>
        </div>

        {% if request.user.is_authenticated %}
            <!-- User Profile Dropdown -->
            <div style="position: relative;">
                <button onclick="toggleUserMenu()"
                        id="user-menu-btn"
                        style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm) var(--spacing-md); border: 2px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); cursor: pointer; min-height: 40px;"
                        aria-label="User menu"
                        aria-expanded="false">
                    {% with u=request.session.user %}
                        {% if u and 'userinfo' in u and u.userinfo.picture %}
                            <img src="{{ u.userinfo.picture }}" alt="Profile" style="width: 24px; height: 24px; border-radius: 50%;">
                        {% else %}
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        {% endif %}

                        {% if u and 'userinfo' in u %}
                            <span>{{ u.full_name|default:u.userinfo.name|default:"User" }}</span>
                        {% else %}
                            <span>{{ request.user.get_full_name|default:request.session.user.full_name|default:request.user.username|default:"User" }}</span>
                        {% endif %}
                    {% endwith %}
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </button>

                <!-- Dropdown Menu (Hidden by default) -->
                <div id="user-menu"
                     style="display: none; position: absolute; right: 0; top: 48px; min-width: 220px; background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 6px; padding: var(--spacing-sm); z-index: 150; box-shadow: var(--shadow-lg);">

                    <!-- Role Badge -->
                    <div style="padding: var(--spacing-sm) var(--spacing-md); margin-bottom: var(--spacing-sm);">
                        <p style="font-size: calc(0.75rem * var(--font-scale)); color: var(--text-secondary); margin: 0 0 var(--spacing-xs) 0;">
                            Signed in as
                        </p>
                        <p style="font-weight: 600; color: var(--text-primary); margin: 0;">
                            {% if request.session.user.role == 'student' %}
                                Student
                            {% elif request.session.user.role == 'teacher' %}
                                {% if request.session.user.verification_status == 'pending' %}
                                    Teacher (Pending)
                                {% elif request.session.user.verification_status == 'approved' %}
                                    Teacher ✓
                                {% else %}
                                    Teacher
                                {% endif %}
                            {% elif request.session.user.role == 'admin' %}
                                Administrator
                            {% else %}
                                User
                            {% endif %}
                        </p>
                    </div>

                    <hr style="margin: var(--spacing-sm) 0; border: none; border-top: 1px solid var(--border-color);">

                    <a href="{% url 'profile_settings' %}" style="display: block; padding: var(--spacing-sm) var(--spacing-md); text-decoration: none; color: var(--text-primary); border-radius: 4px;">
                        Profile Settings
                    </a>

                    {% if request.session.user.role == 'student' %}
                    <a href="{% url 'student_dashboard' %}" style="display: block; padding: var(--spacing-sm) var(--spacing-md); text-decoration: none; color: var(--text-primary); border-radius: 4px;">
                        My Dashboard
                    </a>
                    {% elif request.session.user.role == 'teacher' %}
                    <a href="{% url 'teacher_dashboard' %}" style="display: block; padding: var(--spacing-sm) var(--spacing-md); text-decoration: none; color: var(--text-primary); border-radius: 4px;">
                        Teacher Dashboard
                    </a>
                    {% elif request.session.user.role == 'admin' %}
                    <a href="{% url 'admin_dashboard' %}" style="display: block; padding: var(--spacing-sm) var(--spacing-md); text-decoration: none; color: var(--text-primary); border-radius: 4px;">
                        Admin Dashboard
                    </a>
                    {% endif %}

                    <hr style="margin: var(--spacing-sm) 0; border: none; border-top: 1px solid var(--border-color);">
                    {% if request.session.user.role == 'admin' %}
                    <a href="{% url 'admin_logout' %}" style="display: block; padding: var(--spacing-sm) var(--spacing-md); text-decoration: none; color: #D9A8A8; border-radius: 4px;">
                        Logout
                    </a>
                    {% else %}
                    <a href="{% url 'logout' %}" style="display: block; padding: var(--spacing-sm) var(--spacing-md); text-decoration: none; color: #D9A8A8; border-radius: 4px;">
                        Logout
                    </a>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <!-- Guest User Buttons -->
            <a href="{% url 'login' %}" class="btn btn-outline btn-sm">
                Login
            </a>
        {% endif %}
    </div>
</nav>

<script>
    // Toggle user menu dropdown (click-based, not hover)
    function toggleUserMenu() {
        const menu = document.getElementById('user-menu');
        const btn = document.getElementById('user-menu-btn');
        const isHidden = menu.style.display === 'none';

        menu.style.display = isHidden ? 'block' : 'none';
        btn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
    }

    // Close user menu when clicking outside
    document.addEventListener('click', function(event) {
        const menu = document.getElementById('user-menu');
        const btn = document.getElementById('user-menu-btn');

        if (menu && btn && !menu.contains(event.target) && !btn.contains(event.target)) {
            menu.style.display = 'none';
            btn.setAttribute('aria-expanded', 'false');
        }
    });
</script>
